# Spring 事务
事务：是访问并可能更新数据库中各种数据项的一个程序执行单元（unit）
特点：
A：原子性
C：一致性
I：隔离性
D：持久性

Spring事务声明配置
## Spring事务传播特性
```
<tx:advice id="transactionAdvice" Transaction-manager="transactionManager">
    <tx:attributes>
        <tx:method name="add" propagation="REQUIRED" rollback-for="Exception,RuntimeException,SQLException"/>
    </tx:attributes>
</tx:advice>
```
| 常量名称                      | 常量解释                                                                                                                                                 | 是否默认             |
|---------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|------------------|
| PROPAGATION_REQUIRED      | 支持当前事务，如果当前没有事务，就新建一个事务                                                                                                                              | 是默认，且是最常用的事务传播方式 |
| PROPAGATION_REQUIRED_NEW  | 新建事务，如果当前存在事务，把当前事务挂起。新建的事务将和被挂起的事务没有任何关系，是两个独立的事务。外层事务失败回滚之后，不能回滚内层事务执行的结果，内层事务失败抛出异常，外层事务捕获，也可以不处理回滚操作                                             | 否                |
| PROPAGATION_SUPPORTS      | 支持当前事务，如果当前没有事务，就以非事务方式执行                                                                                                                            | 否                |
| PROPAGATION_MANDATORY     | 支持当前事务，如果当前没有事务，就抛出异常                                                                                                                                | 否                |
| PROPAGATION_NOT_SUPPORTED | 以非事务方式执行操作，如果当前存在事务，就把当前事务挂起                                                                                                                         | 否                |
| PROPAGATION_NEVER         | 以非事务方式执行操作，如果当前存在事务，就抛出异常                                                                                                                            | 否                |
| PROPAGATION_NESTED        | 如果一个活动的事务存在，则运行在一个嵌套的事务中。如果没有活动事务，则按照PROPAGATION_REQUIRED方式执行。它使用了一个单独的事务，这个事务拥有多个可以回滚的保存点。内部事务的回滚不会对外部事务造成影响。它只对DataSourceTransactionManager事务管理器生效 | 否                |
 
## 数据库事务隔离级别

| 隔离级别 | 隔离级别的值 | 导致的问题                                       |
|-----|-----|---------------------------------------------|
|  Read-Uncommitted    |0  | 导致脏读                       |
|  Read-Committed    | 1 | 避免脏读，允许不可重复读和幻读            |
| Repeatable-Read| 2 | 避免脏读、不可重复读，允许幻读                             |
| Serializable     | 3 | 串行化读，事务只能一个一个执行，避免了脏读、 不可重复读、幻读，但执行效率慢，慎重使用 |

## 什么是脏读、不可重复读、幻读

| 类型    | 解释                                                   |
|-------|------------------------------------------------------|
| 脏读    | 读取到其他事务未提交的数据                                        |
| 不可重复读 | 同一事务对同一条数据查询两次， 两次执行之间有其他事务修改了这条数据的某些值，导致同一条数据前后读取不同 |
| 幻读    | 同一个事务中执行两次查询，两次执行之间有其他事务删除或新增了一条数据，导致两次查询的条数不同       |


![](Spring%20事务.jpg)

## 分布式事务
一致性：
强一致性
弱一致性